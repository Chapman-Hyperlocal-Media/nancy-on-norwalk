function load(){clearInterval(timer),NUM_POINTS=document.getElementById("num_points").value,checkboxes(),canvas=new Canvas("canvas"),cloth=new Cloth,run(),timer=setInterval(run,35)}function Cloth(){this.num_iterations=2,this.points=new Array,this.constraints=new Array;for(var t=(1-2*X_OFFSET)/(NUM_POINTS-1),n=(1-2*Y_OFFSET)/(NUM_POINTS-1),s=0,e=TOP_Y;NUM_POINTS>s;s++,e+=n){this.points[s]=new Array;for(var o=0,i=TOP_X;NUM_POINTS>o;o++,i+=t){var r=new Point(new FastVector(i,e),POINT_MASS);if(this.points[s][o]=r,s>0){var a=new Constraint(this.points[s-1][o],this.points[s][o]);this.constraints.push(a)}if(o>0){var a=new Constraint(this.points[s][o-1],this.points[s][o]);this.constraints.push(a)}}}this.points[0][0].inv_mass=0,this.points[0][NUM_POINTS-1].inv_mass=0,this.num_constraints=this.constraints.length}function getMouseCoords(t){t=t||window.event;var n=t.pageX||t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),s=t.pageY||t.clientY+(document.documentElement.scrollTop||document.body.scrollTop);return new FastVector(n/canvas.width,s/canvas.height)}function checkboxes(){draw_constraints=document.getElementById("constraints").checked,draw_points=document.getElementById("points").checked}var PI=3.1415,TWO_PI=2*PI,NUM_POINTS=10,X_OFFSET=.25,Y_OFFSET=.25,TOP_X=.25,TOP_Y=.2,POINT_MASS=1,DRAG=.01,DRAG_C_1=2-DRAG,DRAG_C_2=1-DRAG,GRAVITY=new FastVector(0,.5),DT=.05,GRAVITY_SCALED=GRAVITY.multiply(DT*DT),canvas,cloth,timer="",draw_constraints=!1,draw_points=!0;run=function(){canvas.clear(),cloth.update()},Cloth.prototype={update:function(){for(var t=0;NUM_POINTS>t;t++)for(var n=0;NUM_POINTS>n;n++)this.points[t][n].move();for(var n=0;n<this.num_iterations;n++)for(var t=0;t<this.num_constraints;t++)this.constraints[t].satisfy();if(draw_constraints)for(var t=0;t<this.num_constraints;t++)this.constraints[t].draw();if(draw_points)for(var t=0;NUM_POINTS>t;t++)for(var n=0;NUM_POINTS>n;n++)this.points[t][n].draw()},getClosestPoint:function(t){for(min_dist=1,min_point=null,i=0;NUM_POINTS>i;i++)for(j=0;NUM_POINTS>j;j++){var n=t.subtract(this.points[i][j].currentPosition()).length();min_dist>n&&(min_dist=n,min_point=this.points[i][j])}return min_point}};var selected_point=null,key_pressed=!1;document.onmousedown=function(t){var n=getMouseCoords(t);canvas.isInside(n)&&(selected_point=cloth.getClosestPoint(n),selected_point.setCurrentPos(n),selected_point.setPreviousPos(n),selected_point.inv_mass=0,document.onmousemove=function(t){var n=getMouseCoords(t);selected_point.setCurrentPos(n),selected_point.setPreviousPos(n),selected_point.inv_mass=0},document.onmouseup=function(){key_pressed||(selected_point.inv_mass=1/POINT_MASS),document.onmousemove=function(){}})},document.onkeydown=function(t){t=t||window.event,null!=t?(71==t.keyCode&&(GRAVITY=0==GRAVITY.sum()?new FastVector(0,.5):new FastVector(0,0),GRAVITY_SCALED=GRAVITY.multiply(DT*DT)),key_pressed=!0):key_pressed=!1},document.onkeyup=function(){key_pressed=!1};