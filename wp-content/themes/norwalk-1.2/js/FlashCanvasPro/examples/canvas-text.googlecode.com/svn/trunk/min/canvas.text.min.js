window.Canvas=window.Canvas||{},window.Canvas.Text={equivalentFaces:{arial:["liberation sans","nimbus sans l","freesans","optimer","dejavu sans"],"times new roman":["liberation serif","helvetiker","linux libertine","freeserif"],"courier new":["dejavu sans mono","liberation mono","nimbus mono l","freemono"],georgia:["nimbus roman no9 l","helvetiker"],helvetica:["nimbus sans l","helvetiker","freesans"],tahoma:["dejavu sans","optimer","bitstream vera sans"],verdana:["dejavu sans","optimer","bitstream vera sans"]},genericFaces:{serif:["times new roman","georgia","garamond","bodoni","minion web","itc stone serif","bitstream cyberbit"],"sans-serif":["arial","verdana","trebuchet","tahoma","helvetica","itc avant garde gothic","univers","futura","gill sans","akzidenz grotesk","attika","typiko new era","itc stone sans","monotype gill sans 571"],monospace:["courier","courier new","prestige","everson mono"],cursive:["caflisch script","adobe poetica","sanvito","ex ponto","snell roundhand","zapf-chancery"],fantasy:["alpha geometrique","critter","cottonwood","fb reactor","studz"]},faces:{},scaling:.962,_styleCache:{}},function(){function initialize(){var t,e,i="canvas.text.js",a=document.getElementsByTagName("script");for(t=0;t<a.length;t++){var s=a[t].src;if(-1!=s.indexOf(i)){var r=s.split("?");if(ctxt.basePath=r[0].replace(i,""),r[1]){var n=r[1].split("&");for(e=n.length-1;e>=0;--e){var o=n[e].split("=");ctxt.options[o[0]]=o[1]}}break}}}function getCSSWeightEquivalent(t){switch(String(t)){case"bolder":case"bold":case"900":case"800":case"700":return"bold";case"600":case"500":case"400":default:case"normal":return"normal"}}function getElementStyle(t){return document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle||t.style}function getXHR(){if(!ctxt.xhr){var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(i=0;i<t.length;i++)try{ctxt.xhr=t[i]();break}catch(e){}}return ctxt.xhr}function arrayContains(t,e){var i,a=t.length;for(i=a-1;i>=0;--i)if(t[i]===e)return!0;return!1}var isOpera9=window.opera&&navigator.userAgent.match(/Opera\/9/),proto=window.CanvasRenderingContext2D?window.CanvasRenderingContext2D.prototype:document.createElement("canvas").getContext("2d").__proto__,ctxt=window.Canvas.Text;ctxt.options={fallbackCharacter:" ",dontUseMoz:!1,reimplement:!1,debug:!1,autoload:!1},initialize();var moz=!ctxt.options.dontUseMoz&&proto.mozDrawText&&!proto.strokeText;if(proto.strokeText&&!ctxt.options.reimplement)return window._typeface_js={loadFace:function(){}};ctxt.lookupFamily=function(t){var e,i,a,s,r=this.faces,n=this.equivalentFaces,o=this.genericFaces;if(r[t])return r[t];if(o[t])for(i=0;i<o[t].length;i++)if(a=this.lookupFamily(o[t][i]))return a;if(!(s=n[t]))return!1;for(i=0;i<s.length;i++)if(e=r[s[i]])return e;return!1},ctxt.getFace=function(family,weight,style){var face=this.lookupFamily(family);if(!face)return!1;if(face&&face[weight]&&face[weight][style])return face[weight][style];if(!this.options.autoload)return!1;var faceName=family.replace(/[ -]/g,"_")+"-"+weight+"-"+style,xhr=this.xhr,url=this.basePath+this.options.autoload+"/"+faceName+".js";if(xhr=getXHR(),xhr.open("get",url,!1),xhr.send(null),200==xhr.status)return eval(xhr.responseText),this.faces[family][weight][style];throw"Unable to load the font ["+family+" "+weight+" "+style+"]"},ctxt.loadFace=function(t){var e=t.familyName.toLowerCase();return this.faces[e]=this.faces[e]||{},this.faces[e][t.cssFontWeight]=this.faces[e][t.cssFontWeight]||{},this.faces[e][t.cssFontWeight][t.cssFontStyle]=t,t},window._typeface_js={faces:ctxt.faces,loadFace:ctxt.loadFace},ctxt.getFaceFromStyle=function(t){var e,i,a=getCSSWeightEquivalent(t.weight),s=t.family;for(e=0;e<s.length;e++)if(i=this.getFace(s[e].toLowerCase(),a,t.style))return i;return!1};try{proto.font="10px sans-serif",proto.textAlign="start",proto.textBaseline="alphabetic"}catch(e){}proto.parseStyle=function(t){if(ctxt._styleCache[t])return this.getComputedStyle(ctxt._styleCache[t]);var e,a,s={};for(this._elt||(this._elt=document.createElement("span"),this.canvas.appendChild(this._elt)),this.canvas.font="10px sans-serif",this._elt.style.font=t,e=getElementStyle(this._elt),s.size=e.fontSize,s.weight=getCSSWeightEquivalent(e.fontWeight),s.style=e.fontStyle,a=e.fontFamily.split(","),i=0;i<a.length;i++)a[i]=a[i].replace(/^["'\s]*/,"").replace(/["'\s]*$/,"");return s.family=a,this.getComputedStyle(ctxt._styleCache[t]=s)},proto.buildStyle=function(t){return t.style+" "+t.weight+" "+t.size+'px "'+t.family+'"'},proto.renderText=function(t,e){var i,a=ctxt.getFaceFromStyle(e),s=e.size/a.resolution*.75,r=0,n=t.split(""),o=n.length;for(isOpera9||(this.scale(s,-s),this.lineWidth/=s),i=0;o>i;i++)r+=this.renderGlyph(n[i],a,s,r)},proto.renderGlyph=isOpera9?function(t,e,i,a){var s,r,n,o,c,l,h=e.glyphs[t]||e.glyphs[ctxt.options.fallbackCharacter];if(h){if(h.o)for(o=h._cachedOutline||(h._cachedOutline=h.o.split(" ")),l=o.length,s=0;l>s;)switch(c=o[s++]){case"m":this.moveTo(o[s++]*i+a,o[s++]*-i);break;case"l":this.lineTo(o[s++]*i+a,o[s++]*-i);break;case"q":r=o[s++]*i+a,n=o[s++]*-i,this.quadraticCurveTo(o[s++]*i+a,o[s++]*-i,r,n);break;case"b":r=o[s++]*i+a,n=o[s++]*-i,ctx.bezierCurveTo(o[s++]*i+a,o[s++]*-i,o[s++]*i+a,o[s++]*-i,r,n)}return h.ha*i}}:function(t,e){var i,a,s,r,n,o,c=e.glyphs[t]||e.glyphs[ctxt.options.fallbackCharacter];if(c){if(c.o)for(r=c._cachedOutline||(c._cachedOutline=c.o.split(" ")),o=r.length,i=0;o>i;)switch(n=r[i++]){case"m":this.moveTo(r[i++],r[i++]);break;case"l":this.lineTo(r[i++],r[i++]);break;case"q":a=r[i++],s=r[i++],this.quadraticCurveTo(r[i++],r[i++],a,s);break;case"b":a=r[i++],s=r[i++],ctx.bezierCurveTo(r[i++],r[i++],r[i++],r[i++],a,s)}c.ha&&this.translate(c.ha,0)}},proto.getTextExtents=function(t,e){var i,a,s=0,r=0,n=ctxt.getFaceFromStyle(e),o=t.length;for(i=0;o>i;i++)a=n.glyphs[t.charAt(i)]||n.glyphs[ctxt.options.fallbackCharacter],s+=Math.max(a.ha,a.x_max),r+=a.ha;return{width:s,height:n.lineHeight,ha:r}},proto.getComputedStyle=function(t){var e,i=getElementStyle(this.canvas),a={},s=t.size,r=parseFloat(i.fontSize),n=parseFloat(s);for(e in t)a[e]=t[e];return a.size="number"==typeof s||-1!=s.indexOf("px")?n:-1!=s.indexOf("em")?r*n:-1!=s.indexOf("%")?r/100*n:-1!=s.indexOf("pt")?n/.75:r,a},proto.getTextOffset=function(t,e,i){var a=getElementStyle(this.canvas),s=this.measureText(t),r=e.size/i.resolution*.75,n={x:0,y:0,metrics:s,scale:r};switch(this.textAlign){default:case null:case"left":break;case"center":n.x=-s.width/2;break;case"right":n.x=-s.width;break;case"start":n.x="rtl"==a.direction?-s.width:0;break;case"end":n.x="ltr"==a.direction?-s.width:0}switch(this.textBaseline){case"alphabetic":break;default:case null:case"ideographic":case"bottom":n.y=i.descender;break;case"hanging":case"top":n.y=i.ascender;break;case"middle":n.y=(i.ascender+i.descender)/2}return n.y*=r,n},proto.drawText=function(t,e,i,a,s){var r=this.parseStyle(this.font),n=ctxt.getFaceFromStyle(r),o=this.getTextOffset(t,r,n);if(this.save(),this.translate(e+o.x,i+o.y),n.strokeFont&&!s&&(this.strokeStyle=this.fillStyle),this.beginPath(),moz?(this.mozTextStyle=this.buildStyle(r),this[s?"mozPathText":"mozDrawText"](t)):(this.scale(ctxt.scaling,ctxt.scaling),this.renderText(t,r),n.strokeFont&&(this.lineWidth=r.size*("bold"==r.weight?.5:.3))),this[s||n.strokeFont&&!moz?"stroke":"fill"](),this.closePath(),this.restore(),ctxt.options.debug){var c=Math.floor(o.x+e)+.5,l=Math.floor(i)+.5;this.save(),this.strokeStyle="#F00",this.lineWidth=.5,this.beginPath(),this.moveTo(c+o.metrics.width,l),this.lineTo(c,l),this.moveTo(c-o.x,l+o.y),this.lineTo(c-o.x,l+o.y-r.size),this.stroke(),this.closePath(),this.restore()}},proto.fillText=function(t,e,i,a){this.drawText(t,e,i,a,!1)},proto.strokeText=function(t,e,i,a){this.drawText(t,e,i,a,!0)},proto.measureText=function(t){var e=this.parseStyle(this.font),i={width:0};if(moz)this.mozTextStyle=this.buildStyle(e),i.width=this.mozMeasureText(t);else{var a=ctxt.getFaceFromStyle(e),s=e.size/a.resolution*.75;i.width=this.getTextExtents(t,e).ha*s*ctxt.scaling}return i}}();