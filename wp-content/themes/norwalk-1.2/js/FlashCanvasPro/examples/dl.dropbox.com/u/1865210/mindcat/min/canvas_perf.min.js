function canvas_perf(){function a(){return P}function t(){p++}function e(a){return util.getHSBColor(Math.random(),1,1,a?k:!1)}function r(a){return util.getHSBColor(p%1e4/1e4,1,1,a?k:!1)}function n(a){return a?B:z}function o(a){return a?R:q}function i(a){a.moveTo(H[0],D[0]);for(var t=1,e=H.length;e>t;t++)a.lineTo(H[t],D[t]);a.closePath()}function l(){s();var a=document.getElementById("cvs"),t=a.getContext("2d");try{f(t)}catch(e){log.print("onload:>>> ex="+e)}var r=document.getElementById("alpha");r.onchange=function(a){I=a.target.checked}}function h(){log.print("Start perfomance test"),_=-1,I=document.getElementById("alpha").checked,E={},v()}function m(){if(C){var t=a();t.restore(),clearTimeout(C),C=null}x&&(clearInterval(x),x=null)}function f(a){for(var t=y,e=S,r=Math.min(t,e),n=(t-r)/2,o=(e-r)/2,i=0;r>i;i++){var l=r-2*i;if(0>l)break;a.strokeStyle="lime",a.strokeRect(n+i,o+i,n+l,o+l),i++,l=r-2*i,a.strokeStyle="blue",a.beginPath(),a.moveTo(n+i,o+i),a.lineTo(n+i+l,o+i),a.lineTo(n+i+l,o+i+l),a.lineTo(n+i,o+i+l),a.closePath(),a.stroke()}var h="Canvas Performance Test";a.beginPath(),a.fillStyle="yellow",a.font="Bold 30pt Serif",a.fillText(h,10,e/2+10)}function s(){var a=4;B||(B=new Image,B.onload=function(){0==--a&&log.print("Ready!!")},B.src="images/mandel.png"),z||(z=new Image,z.onload=function(){0==--a&&log.print("Ready!!")},z.src="images/mandel.jpg"),R||(R=new Image,R.onload=function(){0==--a&&log.print("Ready!!")},R.src="images/mandel.png"),q||(q=new Image,q.onload=function(){0==--a&&log.print("Ready!!")},q.src="images/mandel.jpg")}function d(){var t=a();t.fillStyle="black",t.fillRect(0,0,y,S)}function c(a){d(),p=0,_=a;var t=perfdefs[a];return t?(g=G[t[0]],b=t[1],w=(new Date).getTime(),!0):!1}function v(){C&&(clearTimeout(C),C=null),x&&(clearInterval(x),x=null);var t=a();t.save(),c(_+1)?(C=setTimeout(function(){t.restore(),M(),v()},3e3),x=setInterval(function(){g.call(G,b,I)},1)):u()}function M(){var a=(new Date).getTime(),t=perfdefs[_][0],e=p/(a-w),r=e/perfdefs[_][2],n=t+": "+e.toPrecision(3)+" ("+r.toPrecision(3)+")";E[t]={value:e,ratio:r},log.print(n)}function u(){var t=a(),e=20,r=10,n=0;try{t.save(),t.beginPath(),t.fillStyle="yellow",t.font="bold 16px sans-serif",t.textBaseline="top";for(var o=0,i=perfdefs.length;i>o;o++){var l=perfdefs[o][0],h=E[l];n+=1/h.ratio,t.fillText(l+": "+h.ratio.toPrecision(3),e,r),r+=16}var m=(i/n).toPrecision(3);r+=10,t.fillStyle="red",t.font="bold 24px sans-serif",t.fillText("Score: "+m,e,r),log.print("Total Score: "+m)}finally{t.restore()}}var g,b,T=document.getElementById("cvs"),P=T.getContext("2d"),y=parseInt(T.width),S=parseInt(T.height),k=.5,p=0,I=!1,_=0,w=0,C=null,x=null,B=null,R=null,z=null,q=null,E={},H=[1e4,12245,19511,13633,15878,1e4,4122,6367,489,7755],D=[0,6910,6910,11180,18090,13820,18090,11180,6910,6910],G={empty:function(a){for(var e=0;a>e;e++)t()},hline:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*o,s=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.moveTo(m,s),l.lineTo(f,s),l.stroke(),t()}},vline:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*i,s=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.moveTo(m,f),l.lineTo(m,s),l.stroke(),t()}},line:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*o,s=Math.random()*i,d=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.moveTo(m,s),l.lineTo(f,d),l.stroke(),t()}},rect:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*o,s=Math.random()*i,d=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.strokeRect(Math.min(m,f),Math.min(s,d),Math.abs(f-m),Math.abs(d-s)),t()}},fill_rect:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){{var m=Math.random()*o,f=Math.random()*o,s=Math.random()*i,d=Math.random()*i;Math.min(m,f),Math.min(s,d)}l.beginPath(),l.fillStyle=e(n),l.fillRect(Math.min(m,f),Math.min(s,d),Math.abs(f-m),Math.abs(d-s)),t()}},lines:function(r,n){var o=y,i=S,l=a(),h=Math.random()*o,m=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.moveTo(h,m);for(var f=0;r>f;f++)h=Math.random()*o,m=Math.random()*i,l.lineTo(h,m),t();l.stroke()},arc:function(r,n){for(var o=y,i=S,l=2*Math.PI,h=a(),m=0;r>m;m++){var f=Math.random()*o,s=Math.random()*i,d=Math.random()*Math.min(Math.min(f,o-f),Math.min(s,i-s));h.beginPath(),h.strokeStyle=e(n),h.arc(f,s,d,0,l,!0),h.stroke(),t()}},fill_arc:function(r,n){for(var o=y,i=S,l=2*Math.PI,h=a(),m=0;r>m;m++){var f=Math.random()*o,s=Math.random()*i,d=Math.random()*Math.min(Math.min(f,o-f),Math.min(s,i-s));h.beginPath(),h.fillStyle=e(n),h.arc(f,s,d,0,l,!0),h.fill(),t()}},bezier:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*o,s=Math.random()*o,d=Math.random()*o,c=Math.random()*i,v=Math.random()*i,M=Math.random()*i,u=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.moveTo(m,c),l.bezierCurveTo(f,v,s,M,d,u),l.stroke(),t()}},fill_bezier:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*o,s=Math.random()*o,d=Math.random()*o,c=Math.random()*i,v=Math.random()*i,M=Math.random()*i,u=Math.random()*i,g=(m+f)/2,b=(c+v)/2,T=(s+d)/2,P=(M+u)/2;l.beginPath(),l.fillStyle=e(n),l.moveTo(g,b),l.bezierCurveTo(f,v,s,M,T,P),l.bezierCurveTo(d,u,m,c,g,b),l.closePath(),l.fill(),t()}},quad:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){var m=Math.random()*o,f=Math.random()*o,s=Math.random()*o,d=Math.random()*i,c=Math.random()*i,v=Math.random()*i;l.beginPath(),l.strokeStyle=e(n),l.moveTo(m,d),l.quadraticCurveTo(f,c,s,v),l.stroke(),t()}},delta:0,curves:function(r,n){for(var o=y,i=o/2,l=o/2,h=2*Math.PI,m=32,f=h/m,s=a(),d=this.delta,c=0;r>c;c++){var v=d,M=i+l*Math.cos(v),u=i+l*Math.sin(v);s.beginPath(),s.strokeStyle=e(n),s.moveTo(M,u);for(var g=1;m>g;g+=2){v=g*f+d;var b=l*Math.random()/8;M=i+b*Math.cos(v),u=i+b*Math.sin(v),v=(g+1)*f+d;var T=i+l*Math.cos(v),P=i+l*Math.sin(v);s.quadraticCurveTo(M,u,T,P),t()}s.stroke()}this.delta+=.05},fill_curves:function(r,n){for(var o=y,i=o/2,l=o/2,h=2*Math.PI,m=32,f=h/m,s=a(),d=this.delta,c=0;r>c;c++){var v=d,M=i+l*Math.cos(v),u=i+l*Math.sin(v);s.beginPath(),s.fillStyle=e(n),s.moveTo(M,u);for(var g=1;m>g;g+=2){v=g*f+d;var b=l*Math.random()/8;M=i+b*Math.cos(v),u=i+b*Math.sin(v),v=(g+1)*f+d;var T=i+l*Math.cos(v),P=i+l*Math.sin(v);s.quadraticCurveTo(M,u,T,P),t()}s.fill()}this.delta+=.05},stroke_star:function(e,n){var o=y,l=S,h=a();h.strokeStyle=r(n),h.lineWidth=500;for(var m=0;l>m;m+=40)for(var f=0;o>f;f+=40)h.beginPath(),h.save(),h.translate(f,m),h.rotate(p/2e3),h.scale(.002,.002),i(h),h.stroke(),h.restore(),t()},fill_star:function(e,n){var o=y,l=S,h=a();h.fillStyle=r(n);for(var m=0;l>m;m+=40)for(var f=0;o>f;f+=40)h.beginPath(),h.save(),h.translate(f,m),h.rotate(p/2e3),h.scale(.002,.002),i(h),h.fill(),h.restore(),t()},transform:function(r,n){for(var o=y,i=S,l=a(),h=0;r>h;h++){l.strokeStyle=e(n);for(var m=0;o>m;m+=50)l.beginPath(),l.moveTo(m,0),l.lineTo(m,i),l.stroke();for(var f=0;i>f;f+=50)l.beginPath(),l.moveTo(0,f),l.lineTo(o,f),l.stroke();l.beginPath(),l.translate(o/2,i/2),l.rotate(.02),l.scale(1.004,.996),l.translate(-o/2,-i/2),l.stroke(),t()}},image:function(e,r){for(var o=y,i=S,l=n(r),h=l.width,m=l.height,f=o-h,s=i-m,d=a(),c=0;e>c;c++){var v=Math.random()*f,M=Math.random()*s;d.beginPath(),d.drawImage(l,v,M),t()}},image_scale:function(e,r){for(var o=y,i=S,l=n(r),h=a(),m=0;e>m;m++){var f=Math.random()*o,s=Math.random()*o,d=Math.random()*i,c=Math.random()*i;h.beginPath(),h.drawImage(l,Math.min(f,s),Math.min(d,c),Math.abs(s-f),Math.abs(c-d)),t()}},image_rotate:function(e,r){for(var n=y,i=S,l=o(r),h=l.width,m=l.height,f=a(),s=0;e>s;s++)f.beginPath(),f.save(),f.translate(n/2,i/2),f.rotate(p/50),f.translate(-h/2,-m/2),f.drawImage(l,0,0),f.restore(),t()},linear_gradient:function(e,r){for(var n=y,o=S,i=10,l=a(),h=l.createLinearGradient(0,0,100,100),m=0;i>m;m++){var f=m/(i-1),s=util.getHSBColor(f,1,1,r?k:!1);h.addColorStop(f,s)}for(var m=0;e>m;m++){var d=Math.random()*n,c=Math.random()*n,v=Math.random()*o,M=Math.random()*o,u=Math.min(d,c),g=Math.min(v,M),b=Math.abs(c-d),T=Math.abs(M-v);l.beginPath(),l.save(),l.transform(b/100,0,0,T/100,u,g),l.fillStyle=h,l.rect(0,0,100,100),l.fill(),l.restore(),t()}},radial_gradient:function(e,r){for(var n=y,o=S,i=10,l=a(),h=l.createRadialGradient(20,20,20,50,50,70),m=0;i>m;m++){var f=m/(i-1),s=util.getHSBColor(f,1,1,r?k:!1);h.addColorStop(f,s)}for(var m=0;e>m;m++){var d=Math.random()*n,c=Math.random()*n,v=Math.random()*o,M=Math.random()*o,u=Math.min(d,c),g=Math.min(v,M),b=Math.abs(c-d),T=Math.abs(M-v);l.beginPath(),l.save(),l.transform(b/100,0,0,T/100,u,g),l.fillStyle=h,l.rect(0,0,100,100),l.fill(),l.restore(),t()}},text:function(r,n){for(var o=y,i=S,l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",h=a(),m=h.measureText(l).width,f=Math.abs(o-m)/2,s=0;r>s;s++){var d=f+Math.random()*(o-m),c=Math.random()*i;h.save(),h.font="Bold 20pt Serif",h.fillStyle=e(n),h.fillText(l,d,c),h.restore(),t()}},clip:function(r,n){var l=y,h=S,m=a(),f=o(n);m.beginPath(),m.save();var s=l/2e4;m.translate(0,20),m.scale(s,s),i(m),m.restore(),m.clip();for(var d=0;r>d;d++){var c=Math.random()*l,v=Math.random()*l,M=Math.random()*h,u=Math.random()*h;m.drawImage(f,c,M),m.beginPath(),m.lineWidth=10,m.strokeStyle=e(n),m.moveTo(c,M),m.lineTo(v,u),m.stroke(),t()}}};return l(),{start:h,stop:m}}var perfdefs=[["hline",1e3,30],["vline",1e3,15],["line",1e3,6],["rect",1e3,5],["fill_rect",500,5],["lines",1e3,8],["arc",1e3,4],["fill_arc",1e3,7],["bezier",1e3,3],["fill_bezier",1e3,4],["quad",1e3,4],["curves",50,5],["fill_curves",50,8],["stroke_star",1e3,7],["fill_star",1e3,12],["transform",10,.2],["image",100,.3],["image_scale",100,.8],["image_rotate",15,.3],["linear_gradient",100,2],["radial_gradient",100,.3],["text",100,.6],["clip",100,.8]];