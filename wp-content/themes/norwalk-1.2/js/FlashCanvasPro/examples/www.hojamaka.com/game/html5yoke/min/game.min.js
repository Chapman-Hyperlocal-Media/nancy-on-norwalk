function setImage(t){var e=new Image;return e.onload=checkLoad,e.onerror=checkLoad,e.onabort=checkLoad,e.src=t,e}function checkLoad(){imageCount++,imageCount>=allImageCount&&init()}function init(){player.reset(),bulletCount=0,bullets=[],score=0,ziki=2,gameOverFlag=!1,timer=setInterval(tick,33),bulletTick=10,twitterButton.disabled=!0}function tick(){bulletCount=(bulletCount+1)%bulletTick,0==bulletCount&&(bullets.push(new Bullet),score++,60==score&&(bulletTick=5),150==score&&(bulletTick=3),300==score&&(bulletTick=2),1e3==score&&(bulletTick=1));for(var t=0;t<bullets.length;t++)bullet=bullets[t],bullet.move(),bullet.checkRemove()&&(bullets.splice(t,1),t--),bullet.hitTest(player)&&(explosion.start(),ziki--);draw()}function result(){clearInterval(timer),twitterButton.disabled=!1;var t=document.getElementById("canvas").getContext("2d");t.fillStyle="#000000",t.fillRect(0,0,640,480),t.font="72px 'Times New Roman'",t.fillStyle="#ffffff",t.fillText("Result",200,100),t.font="36px 'Times New Roman'",t.fillText("Score: "+score,200,260),canvas.onclick=function(){canvas.onclick=void 0,init()}}function onMouseMove(t){t=t||window.event;var e=t.target||t.srcElement,i=e.getBoundingClientRect();player.x=t.clientX-i.left,player.y=t.clientY-i.top,player.x>635&&(player.x=635),player.x<5&&(player.x=5),player.y>475&&(player.y=475),player.y<5&&(player.y=5)}function draw(){var t=document.getElementById("canvas").getContext("2d");t.clearRect(0,0,640,480);for(var e=0;ziki>e;e++)t.drawImage(player.image,5+35*e,5,20,20);for(explosion.finishFlag?player.draw(t):explosion.draw(t),e=0;e<bullets.length;e++)bullets[e].draw(t);t.font="14px 'Times New Roman'",t.fillStyle="#ffffff",t.fillText("Score: "+score,100,10),gameOverFlag&&result()}function randomInt(t){return Math.floor(Math.random()*t)}function trace(t){debug.innerHTML=t}var canvas,player,explosion,bullet1,bullet2,allImageCount=2,imageCount=0,debug,bulletCount=0,bullets=[],score=0,ziki=2,timer,gameOverFlag=!1,bulletTick,twitterButton;Player=function(t){this.image=t,this.x=0,this.y=0,this.count=0,this.hitFlag=!1},Player.prototype={draw:function(t){this.count<31&&this.count%2==0&&t.drawImage(this.image,this.x-16,this.y-16),31==this.count&&(this.hitFlag=!0,t.drawImage(this.image,this.x-16,this.y-16)),this.count++,this.count>31&&(this.count=31)},reset:function(){this.count=0,this.hitFlag=!1}},Explosion=function(t){this.image=t,this.x=0,this.y=0,this.count=0,this.finishFlag=!0},Explosion.prototype={draw:function(t){if(this.count<16){var e=this.count%8,i=Math.floor(this.count/8);t.drawImage(this.image,96*e,96*i,96,96,this.x-48,this.y-48,96,96),this.count++,16==this.count&&(this.finishFlag=!0,player.reset(),0>ziki&&(gameOverFlag=!0))}},start:function(){this.finishFlag=!1,this.count=0,this.x=player.x,this.y=player.y}},Bullet=function(){var t=randomInt(2);1==t?(this.x=-20+680*randomInt(2),this.y=randomInt(480)):(this.x=randomInt(640),this.y=-20+520*randomInt(2));var e=Math.atan2(this.y-player.y,this.x-player.x),i=7*Math.random()+3;this.ax=-Math.cos(e)*i,this.ay=-Math.sin(e)*i},Bullet.prototype={move:function(){this.x+=this.ax,this.y+=this.ay},hitTest:function(t){var e=this.x-t.x,i=this.y-t.y,n=Math.sqrt(Math.pow(e,2)+Math.pow(i,2));return 16>=n&&explosion.finishFlag&&t.hitFlag?!0:!1},checkRemove:function(){return this.x<-20||this.x>660||this.y<-20||this.y>500?!0:!1},draw:function(t){t.beginPath(),t.fillStyle="rgb(255, 255, 255)",t.arc(this.x,this.y,3,0,2*Math.PI,!1),t.fill()}},window.onload=function(){twitterButton=document.getElementById("twitterButton"),twitterButton.disabled=!0,twitterButton.onclick=function(){window.open("http://twitter.com/home?status="+encodeURI("HTML5 TAMAYOKE!!!111 SCORE:"+score+" http://www.hojamaka.com/game/html5yoke/"))},canvas=document.getElementById("canvas"),canvas.onmousemove=onMouseMove,debug=document.getElementById("debug"),player=new Player(setImage("player.png")),explosion=new Explosion(setImage("bakuen01.png"))};